@startuml VRP_High_Level_Architecture

title VRP System - High-Level Architecture Design

!define RECTANGLE class

skinparam componentStyle rectangle

' ============================================
' ACTORS
' ============================================
actor "Planner\nUser" as Planner
actor "Customer\nUser" as Customer

' ============================================
' FRONTEND LAYER
' ============================================
card "Presentation Layer" {
    component "Web Frontend" as WebUI <<Frontend>> {
    }
}

' ============================================
' ENTRY SERVICE (Main Backend)
' ============================================
card "Entry Service\n(Spring Boot - Port 8080)" <<EntryService>> {

    ' API Layer
    component "API Gateway Layer" as APILayer {
        [REST Controllers]
    }

    ' Business Layer
    component "Business Logic Layer" as BusinessLayer {
    }

    ' Integration Layer
    component "Integration Layer" as IntegrationLayer {
    }

    ' Data Access Layer
    component "Data Access Layer" as DataLayer {
    }
}

' ============================================
' ENGINE SERVICE (Optimization)
' ============================================
card "Engine Service\n(Python/Java - Port 8081)" <<EngineService>> {

    component "API Layer" as EngineAPI {
    }

    component "Optimization Engine" as OptEngine {
    }

    component "Algorithm Implementations" as Algorithms {
        [Local Neighbour Search]
        (OR-Tools)
        [Genetic Algorithm]
        [Tabu Search]
    }
}

' ============================================
' DATA STORAGE
' ============================================
card "Data Storage Layer" <<Storage>> {
    database "MySQL Database\n(with Spatial Extension)" as MySQL {

    }

    storage "File Storage" as FileStorage {
    }
}

' ============================================
' EXTERNAL SERVICES
' ============================================
card "External Services" <<External>> {
    component "Email Server\n(SMTP)" as EmailServer
    component "Map Provider\n(OpenStreetMap/Google)" as MapProvider
    component "Geocoding API\n(Optional)" as Geocoding
}

' ============================================
' RELATIONSHIPS - USER TO FRONTEND
' ============================================
Planner --> WebUI : HTTPS
Customer --> WebUI : HTTPS

' ============================================
' RELATIONSHIPS - FRONTEND TO ENTRY SERVICE
' ============================================
WebUI --> APILayer : REST API\n(HTTPS)

note right of WebUI
    Frontend communicates với
    Entry Service qua REST APIs
end note

' ============================================
' RELATIONSHIPS - ENTRY SERVICE INTERNAL
' ============================================
APILayer --> BusinessLayer : "Internal Calls"
BusinessLayer --> IntegrationLayer : "Integration"
BusinessLayer --> DataLayer : "Data Access"

' ============================================
' RELATIONSHIPS - ENTRY SERVICE TO STORAGE
' ============================================
DataLayer --> MySQL : JDBC\n(Connection Pool)
IntegrationLayer --> FileStorage : "File I/O"

note bottom of MySQL
    MySQL with Spatial Extensions:
    • POINT data type for locations
    • ST_Distance() for geo queries
    • Indexes on spatial columns
end note

' ============================================
' RELATIONSHIPS - ENTRY ↔ ENGINE SERVICE
' ============================================
IntegrationLayer --> EngineAPI : HTTP/gRPC\n(Async)
' ============================================
' RELATIONSHIPS - ENGINE SERVICE INTERNAL
' ============================================
EngineAPI --> OptEngine : "Process Request"
OptEngine --> Algorithms : "Select & Execute"

' ============================================
' RELATIONSHIPS - ENTRY SERVICE TO EXTERNAL
' ============================================
IntegrationLayer --> EmailServer : SMTP\n(TLS)
WebUI --> MapProvider : HTTPS\n(Map Tiles)
IntegrationLayer --> Geocoding : HTTPS\n(Optional)


' ============================================
' LEGEND
' ============================================
legend right
    |<back:LightBlue>   </back>| Frontend Components |
    |<back:LightGreen>  </back>| Entry Service |
    |<back:LightYellow> </back>| Engine Service |
    |<back:LightCoral>  </back>| External Services |
    |<back:Wheat>       </back>| Data Storage |

    **Architecture Style:**
    • Entry Service: Layered Architecture
    • Engine Service: Modular/Plugin Architecture
    • Communication: REST API / gRPC
    • Database: Relational with Spatial Extension

    **Key Design Decisions:**
    1. Separation of Entry vs Engine services
    2. Async optimization with email notification
    3. Multi-tenancy via Branch isolation
    4. Geospatial data with POINT type
    5. File-based import/export
endlegend

@enduml