<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VRP System - Vehicle Route Planning</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- ============================================ -->
<!-- SCREEN 1: DEPOT SETUP -->
<!-- ============================================ -->
<div id="screen-depot-setup" class="screen active">
  <div class="setup-container">
    <div class="setup-header">
      <h1>üè¢ Thi·∫øt l·∫≠p Depot - Kho h√†ng</h1>
      <p>Vui l√≤ng ch·ªçn v·ªã tr√≠ kho h√†ng c·ªßa b·∫°n tr√™n b·∫£n ƒë·ªì</p>
    </div>

    <form id="depot-form" class="setup-form">
      <!-- T√™n Depot -->
      <div class="form-group">
        <label for="depot-name">T√™n Depot <span class="required">*</span></label>
        <input
                type="text"
                id="depot-name"
                name="name"
                placeholder="V√≠ d·ª•: Kho H√† N·ªôi"
                maxlength="100"
                required
        />
      </div>

      <!-- Interactive Map -->
      <div class="form-group">
        <label>V·ªã tr√≠ Depot <span class="required">*</span></label>
        <div id="depot-map" class="setup-map"></div>
        <p class="form-hint">
          üí° Click v√†o b·∫£n ƒë·ªì ƒë·ªÉ ch·ªçn v·ªã tr√≠ kho h√†ng c·ªßa b·∫°n
        </p>
      </div>

      <!-- Auto-filled Location Info -->
      <div class="form-group">
        <label for="depot-address">ƒê·ªãa ch·ªâ</label>
        <input
                type="text"
                id="depot-address"
                name="address"
                placeholder="Click v√†o b·∫£n ƒë·ªì ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn ƒë·ªãa ch·ªâ"
                readonly
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="depot-lat">Latitude</label>
          <input
                  type="text"
                  id="depot-lat"
                  name="latitude"
                  placeholder="21.028511"
                  readonly
          />
        </div>
        <div class="form-group">
          <label for="depot-lng">Longitude</label>
          <input
                  type="text"
                  id="depot-lng"
                  name="longitude"
                  placeholder="105.804817"
                  readonly
          />
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetDepotForm()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-primary">
          L∆∞u Depot
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ============================================ -->
<!-- SCREEN 2: FLEET SETUP -->
<!-- ============================================ -->
<div id="screen-fleet-setup" class="screen">
  <div class="setup-container">
    <div class="setup-header">
      <h1>üöö Thi·∫øt l·∫≠p ƒê·ªôi xe</h1>
      <p>Th√™m th√¥ng tin v·ªÅ ƒë·ªôi xe v√† ph∆∞∆°ng ti·ªán c·ªßa b·∫°n</p>
    </div>

    <form id="fleet-form" class="setup-form">
      <!-- T√™n ƒë·ªôi xe -->
      <div class="form-group">
        <label for="fleet-name">T√™n ƒë·ªôi xe <span class="required">*</span></label>
        <input
                type="text"
                id="fleet-name"
                name="fleetName"
                placeholder="V√≠ d·ª•: ƒê·ªôi xe giao h√†ng n·ªôi th√†nh"
                required
        />
      </div>

      <!-- Vehicle List -->
      <div class="form-group">
        <div class="section-header">
          <label>Danh s√°ch Xe <span class="required">*</span></label>
          <button type="button" class="btn btn-sm btn-success" onclick="addVehicle()">
            + Th√™m xe
          </button>
        </div>

        <div id="vehicles-container" class="vehicles-container">
          <!-- Vehicle items will be added here dynamically -->
        </div>
      </div>

      <!-- Fleet Summary -->
      <div class="fleet-summary">
        <div class="summary-item">
          <span class="summary-label">üìä T·ªïng s·ªë xe:</span>
          <span class="summary-value" id="total-vehicles">0</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">üì¶ T·ªïng t·∫£i tr·ªçng:</span>
          <span class="summary-value" id="total-capacity">0 kg</span>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="goToScreen('screen-depot-setup')">
          ‚Üê Quay l·∫°i
        </button>
        <button type="submit" class="btn btn-primary">
          L∆∞u ƒê·ªôi xe
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ============================================ -->
<!-- SCREEN 3: MAIN SCREEN (Dashboard) -->
<!-- ============================================ -->
<div id="screen-main" class="screen">
  <!-- Top Navbar -->
  <nav class="navbar">
    <div class="navbar-left">
      <button class="btn-icon" onclick="toggleSidebar()">‚ò∞</button>
      <div class="brand">
        <span class="brand-icon">üì¶</span>
        <span class="brand-name">VRP System‚Ñ¢</span>
      </div>
    </div>

    <div class="navbar-center">
      <button class="nav-menu-item active">Dashboard</button>
      <button class="nav-menu-item" onclick="alert('Planning screen - VRP-002')">Planning</button>
      <button class="nav-menu-item" onclick="alert('Analysis screen - VRP-006')">Analysis</button>
      <button class="nav-menu-item" onclick="alert('History screen - VRP-005')">History</button>
    </div>

    <div class="navbar-right">
      <div class="user-menu">
        <span class="user-avatar">üë§</span>
        <span class="user-name">Admin</span>
        <button class="btn-icon">‚ñº</button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-layout">
    <!-- Left Sidebar -->
    <aside id="main-sidebar" class="sidebar">
      <!-- Stats Cards (Horizontal) -->
      <div class="stats-section">
        <h3 class="section-title">üìä TODAY'S STATS</h3>
        <div class="stats-grid">
          <div class="stat-card" onclick="filterOrdersByStatus('SCHEDULED')">
            <div class="stat-number">0</div>
            <div class="stat-label">Scheduled</div>
          </div>
          <div class="stat-card" onclick="filterOrdersByStatus('COMPLETED')">
            <div class="stat-number">0</div>
            <div class="stat-label">Completed</div>
          </div>
          <div class="stat-card" onclick="filterOrdersByStatus('ALL')">
            <div class="stat-number">24</div>
            <div class="stat-label">Total</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div class="stat-label">Routes</div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Depots Section -->
      <div class="sidebar-section">
        <h3 class="section-title">üìç DEPOTS</h3>
        <div id="depots-list" class="depots-list">
          <!-- Will be populated dynamically -->
          <div class="depot-item">
            <div class="depot-header">
              <span class="depot-icon">üìç</span>
              <span class="depot-name">Kho H√† N·ªôi</span>
            </div>
            <div class="depot-details">
              <div class="depot-address">123 Main Street</div>
              <div class="depot-coords">Lat: 21.028511, Lng: 105.804817</div>
              <button class="btn btn-sm btn-text" onclick="centerMapToDepot(21.028511, 105.804817)">
                üìç View on Map
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Fleet Info -->
      <div class="sidebar-section">
        <h3 class="section-title">üöö FLEET INFO</h3>
        <div class="fleet-info">
          <div class="info-row">
            <span class="info-label">Available:</span>
            <span class="info-value">3 / 5 vehicles</span>
          </div>
          <div class="info-row">
            <span class="info-label">In Use:</span>
            <span class="info-value">2 vehicles</span>
          </div>
          <div class="info-row">
            <span class="info-label">Total Capacity:</span>
            <span class="info-value">1500 kg</span>
          </div>
          <div class="info-row">
            <span class="info-label">Available:</span>
            <span class="info-value">900 kg (60%)</span>
          </div>
          <button class="btn btn-sm btn-text" onclick="alert('Fleet details')">
            View Fleet Details ‚Üí
          </button>
        </div>
      </div>

      <!-- Collapse Button -->
      <button class="btn-collapse" onclick="toggleSidebar()">
        ‚óÑ Hide Sidebar
      </button>
    </aside>

    <!-- Main Content Area (70%) -->
    <main class="main-content">
      <!-- Map View -->
      <div class="map-container" id="map-section">
        <div id="main-map" class="main-map"></div>
      </div>

      <!-- Resizable Divider -->
      <div class="resize-divider" id="resize-divider">
        <div class="resize-handle">
          <span class="resize-icon">‚ãÆ</span>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="table-container" id="table-section">
        <div class="table-header">
          <!-- Row 1: Action Buttons -->
          <div class="table-actions-row">
            <button class="btn btn-primary" onclick="openAddOrderModal()">
              <span>+</span> Add Order
            </button>
            <button class="btn btn-secondary" onclick="openImportModal()">
              <span>üì•</span> Import Orders
            </button>
            <button class="btn btn-success" id="btn-plan-routes" disabled>
              <span>üìä</span> Plan Routes
              <span class="badge" id="selected-count">0</span>
            </button>
            <div class="dropdown">
              <button class="btn btn-menu">‚ãÆ</button>
              <div class="dropdown-content">
                <a href="#" onclick="exportOrders()">Export to CSV</a>
                <a href="#" onclick="deleteSelectedOrders()">Delete Selected</a>
                <a href="#" onclick="bulkEditOrders()">Bulk Edit</a>
              </div>
            </div>
          </div>

          <!-- Row 2: Filters -->
          <div class="table-filters-row">
            <div class="filter-group">
              <label>üìÖ</label>
              <input type="date" id="filter-date" value="2025-10-21" onchange="loadOrders()" />
            </div>
            <div class="filter-group">
              <label>Status:</label>
              <select id="filter-status" onchange="applyFilters()">
                <option value="">All</option>
                <option value="SCHEDULED">Scheduled</option>
                <option value="ON_ROUTE">On Route</option>
                <option value="COMPLETED">Completed</option>
                <option value="FAILED">Failed</option>
              </select>
            </div>
            <div class="filter-group">
              <label>Priority:</label>
              <select id="filter-priority" onchange="applyFilters()">
                <option value="">All</option>
                <option value="high">High (1-3)</option>
                <option value="medium">Medium (4-6)</option>
                <option value="low">Low (7+)</option>
              </select>
            </div>
            <div class="filter-group search">
              <span>üîç</span>
              <input type="text" id="filter-search" placeholder="Search orders..." oninput="applyFilters()" />
            </div>
            <button class="btn btn-text" onclick="clearFilters()">Clear</button>
          </div>
        </div>

        <!-- Table Content -->
        <div class="table-content">
          <table id="orders-table" class="data-table">
            <thead>
            <tr>
              <th><input type="checkbox" id="select-all" onchange="toggleSelectAll()" /></th>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Address</th>
              <th>Demand</th>
              <th>Status</th>
            </tr>
            </thead>
            <tbody id="orders-tbody">
            <!-- Empty state -->
            <tr class="empty-state">
              <td colspan="6">
                <div class="empty-content">
                  <div class="empty-icon">üì¶</div>
                  <div class="empty-text">There are no orders on the selected date</div>
                  <button class="btn btn-primary" onclick="openImportModal()">
                    üì• Import Orders
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- Table Footer -->
        <div class="table-footer">
          <div class="footer-info">
            <span>‚úÖ Selected: <strong id="footer-selected">0</strong> orders</span>
            <span class="separator">|</span>
            <span>Showing <strong id="footer-showing">0</strong> of <strong id="footer-total">0</strong> orders</span>
          </div>
          <div class="pagination">
            <button class="btn-page" onclick="previousPage()" disabled>¬´ Previous</button>
            <button class="btn-page active">1</button>
            <button class="btn-page" onclick="nextPage()" disabled>Next ¬ª</button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- ============================================ -->
<!-- SCREEN 4: IMPORT ORDERS MODAL -->
<!-- ============================================ -->
<div id="modal-import" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>üì• Import ƒê∆°n h√†ng</h2>
      <button class="btn-close" onclick="closeImportModal()">‚úï</button>
    </div>

    <form id="import-form" class="modal-body">
      <!-- Import Method Selection (Horizontal) -->
      <div class="form-group">
        <div class="import-method-grid">
          <div class="import-method-label">
            <label>Import method:</label>
          </div>
          <div class="import-method-options">
            <label class="radio-label-inline">
              <input type="radio" name="import-method" value="file" checked onchange="toggleImportMethod()" />
              <span>üìÅ File (CSV/Excel)</span>
            </label>
            <label class="radio-label-inline">
              <input type="radio" name="import-method" value="text" onchange="toggleImportMethod()" />
              <span>üìù Raw Text</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Overwrite Checkbox (Right below import method) -->
      <div class="form-group">
        <div class="import-method-grid">
          <div class="import-method-label">
            <label>Overwrite existing:</label>
          </div>
          <div class="import-method-options">
            <label class="checkbox-label-inline">
              <input type="checkbox" id="import-overwrite" />
              <span>Ghi ƒë√® ƒë∆°n h√†ng ƒë√£ t·ªìn t·∫°i</span>
            </label>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <!-- File Upload Section -->
      <div id="import-file-section" class="import-section">
        <div class="form-group">
          <label>Upload File</label>
          <div class="file-upload-zone" id="file-drop-zone">
            <input type="file" id="import-file" accept=".csv,.xlsx" onchange="handleFileSelect(event)" hidden />
            <div class="upload-content">
              <div class="upload-icon">üìÅ</div>
              <div class="upload-text">
                <p><strong>Click to select file</strong> or drag and drop</p>
                <p class="upload-hint">CSV or Excel files (max 10MB)</p>
              </div>
            </div>
            <div class="file-selected" id="file-selected" style="display: none;">
              <span class="file-name" id="file-name"></span>
              <button type="button" class="btn-remove" onclick="removeFile()">‚úï</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Text Input Section -->
      <div id="import-text-section" class="import-section" style="display: none;">
        <div class="form-group">
          <label>D·ªØ li·ªáu ƒë∆°n h√†ng</label>
          <div class="format-hint">
            <strong>ƒê·ªãnh d·∫°ng:</strong> OrderCode|Name|Phone|Address|Lat|Lng|Demand|TWStart|TWEnd|Priority|Notes
          </div>
          <textarea
                  id="import-text"
                  rows="10"
                  placeholder="ORD001|John|0901234567|123 Main St|21.028511|105.804817|50.5|08:00|12:00|1|Handle with care&#10;ORD002|Jane|0912345678|456 Second Ave|21.030000|105.810000|30.0||||2|"
          ></textarea>
        </div>
      </div>

      <!-- Common Fields -->
      <div class="form-row">
        <div class="form-group">
          <label for="import-delivery-date">Ng√†y giao h√†ng <span class="required">*</span></label>
          <input type="date" id="import-delivery-date" required />
        </div>
        <div class="form-group">
          <label for="import-service-time">Th·ªùi gian ph·ª•c v·ª• (ph√∫t) <span class="required">*</span></label>
          <input type="number" id="import-service-time" value="5" min="0" required />
        </div>
      </div>

      <!-- Helper Section -->
      <div class="help-section">
        <h4>üí° G·ª£i √Ω:</h4>
        <ul>
          <li>File CSV: t·ªëi ƒëa 10MB</li>
          <li>H·ªó tr·ª£ UTF-8 encoding</li>
          <li>Template: <a href="#" onclick="downloadTemplate()">T·∫£i file m·∫´u</a></li>
        </ul>
      </div>
    </form>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeImportModal()">
        H·ªßy
      </button>
      <button type="button" class="btn btn-primary" onclick="submitImport()">
        Import
      </button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
  <div class="loading-spinner"></div>
  <div class="loading-text">ƒêang x·ª≠ l√Ω...</div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="api.js"></script>
<script src="map.js"></script>
<script src="app.js"></script>
</body>
</html>