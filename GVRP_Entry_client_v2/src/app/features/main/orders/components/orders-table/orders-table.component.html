<div class="table-container bg-white rounded-lg shadow-sm overflow-hidden flex flex-col h-full">

  <div class="overflow-auto flex-grow">
    <table mat-table [dataSource]="dataSource" class="w-full">

      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef class="w-12">
          <mat-checkbox (change)="$event ? toggleAllRows() : null"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()"
                        color="primary">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? toggleRow(row) : null"
                        [checked]="selection.isSelected(row)"
                        color="primary">
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="order_code">
        <th mat-header-cell *matHeaderCellDef> Code </th>
        <td mat-cell *matCellDef="let order"> <span class="font-medium text-blue-600">{{order.order_code}}</span> </td>
      </ng-container>

      <ng-container matColumnDef="customer_name">
        <th mat-header-cell *matHeaderCellDef> Customer </th>
        <td mat-cell *matCellDef="let order"> {{order.customer_name}} </td>
      </ng-container>

      <ng-container matColumnDef="address">
        <th mat-header-cell *matHeaderCellDef> Address </th>
        <td mat-cell *matCellDef="let order" class="max-w-[200px] truncate" [matTooltip]="order.address">
          {{order.address}}
        </td>
      </ng-container>

      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef> Priority </th>
        <td mat-cell *matCellDef="let order"> {{order.priority || '—'}} </td>
      </ng-container>

      <ng-container matColumnDef="time_window">
        <th mat-header-cell *matHeaderCellDef> Time Window </th>
        <td mat-cell *matCellDef="let order">
          {{ order.time_window_start ? (order.time_window_start | slice:0:5) + ' - ' + (order.time_window_end | slice:0:5) : '—' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="demand">
        <th mat-header-cell *matHeaderCellDef> Demand </th>
        <td mat-cell *matCellDef="let order"> {{order.demand}} kg </td>
      </ng-container>

      <ng-container matColumnDef="service_time">
        <th mat-header-cell *matHeaderCellDef> Service Time </th>
        <td mat-cell *matCellDef="let order"> {{order.service_time}} min </td>
      </ng-container>

      <ng-container matColumnDef="notes">
        <th mat-header-cell *matHeaderCellDef> Notes </th>
        <td mat-cell *matCellDef="let order" class="max-w-[150px] truncate text-gray-500" [matTooltip]="order.delivery_notes">
          {{order.delivery_notes || '—'}}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let order">
          <div class="flex items-center gap-1 font-medium" [ngClass]="getStatusColor(order.status)">
            <mat-icon class="text-[18px] leading-[18px] h-[18px] w-[18px]">{{getStatusIcon(order.status)}}</mat-icon>
            {{order.status}}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let order">
          <button mat-icon-button color="primary" matTooltip="Edit Order" (click)="editOrder.emit(order.id)">
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="bg-gray-50"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"
          class="hover:bg-blue-50 transition-colors"
          [ngClass]="{'bg-blue-50': selection.isSelected(row)}">
      </tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell p-8 text-center text-gray-500" [attr.colspan]="displayedColumns.length">
          <mat-icon class="text-4xl mb-2">inbox</mat-icon>
          <p class="text-lg font-medium">No orders found on the selected date</p>
        </td>
      </tr>
    </table>
  </div>

  <mat-paginator
    [length]="totalElements"
    [pageSize]="pageSize"
    [pageIndex]="currentPage"
    [pageSizeOptions]="[5, 10, 20, 50]"
    (page)="pageChange.emit($event)"
    showFirstLastButtons>
  </mat-paginator>
</div>
